{% extends "registration/master.html" %}

{% block content %}

<div class="modal fade" id="ageModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">Why do we need your birthdate?</h4>
      </div>
      <div class="modal-body">
	<p>Please contact <a href="mailto:registration@furthemore.org">registration@furthemore.org</a> if you have any questions.</p>
      </div>
    </div>
  </div>
</div>
<div class="modal fade" id="jerseyModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">Year 5 Jersey</h4>
      </div>
      <div class="modal-body">
	<img width="400" src="/static/img/attendee_jersey.jpg"/>
      </div>
    </div>
  </div>
</div>
<div class="modal fade" id="jerseyStaffModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">Year 5 Staff Jersey</h4>
      </div>
      <div class="modal-body">
	<img width="400" src="/static/img/staff_jersey.jpg"/>
      </div>
    </div>
  </div>
</div>

	{% if not staff %}
		<h1>Staff Registration - Furthemore 2017</h1>
		<p>Your session has expired. Please use the link in your registration email again to start over.</p>
	{% else %}

	<form class="form-horizontal" role="form" data-toggle="validator">
	<div class="tab-content">
	<div role="tabpanel" class="tab-pane fade in active" id="personal">
		<h1>Staff Registration - Furthemore 2017</h1>

		<p>Please review and update the information below. If you have any questions about this form, please contact <a href='mailto:registration@furthemore.org'>registration@furthemore.org</a></p>

		<hr>
			
                <div class="form-group">
                    <label for="firstName" class="col-sm-3 control-label">Full (Legal) Name</label>
                    <div class="col-sm-4">
                        <input type="text" id="firstName" value="{{staff.attendee.firstName}}" placeholder="First Name" class="form-control" autofocus required data-error="First name is required. ">
                    </div>
		    <div class="col-sm-5">
                        <input type="text" id="lastName" value={{staff.attendee.lastName}} placeholder="Last Name" class="form-control" autofocus required data-error="Last name is required.">
                    </div>
		    <div class="col-sm-offset-3 help-block with-errors" style="padding-left:15px;"></div>
                </div>
                <div class="form-group">
                    <label for="email" class="col-sm-3 control-label">Email</label>
                    <div class="col-sm-9">
                        <input type="email" id="email" value="{{staff.attendee.email}}" class="form-control" disabled />
                    </div>
		    <div class="col-sm-offset-3 help-block with-errors"style=" padding-left:15px;"></div>
		</div>
                <div class="form-group">
                    <label for="phone" class="col-sm-3 control-label">Phone Number</label>
                    <div class="col-sm-9">
                        <input type="phone" id="phone" value="{{staff.attendee.phone}}" placeholder="Phone Number" class="form-control" required data-error="Phone number is required.">
                    </div>
		    <div class="col-sm-offset-3 help-block with-errors"style=" padding-left:15px;"></div>
                </div>
                <div class="form-group">
                    <label for="add1" class="col-sm-3 control-label">Address</label>
                    <div class="col-sm-9">
                        <input type="text" name="add1" id="add1" value="{{staff.attendee.address1}}" placeholder="Address Line 1" class="form-control" required data-error="Address is required.">
                    </div>
		    <div class="col-sm-offset-3 help-block with-errors"style=" padding-left:15px;"></div>
                </div>
                <div class="form-group">
                    <label for="add2" class="col-sm-3 control-label">&nbsp;</label>
                    <div class="col-sm-9">
                        <input type="text" name="add2" id="add2" value="{{staff.attendee.address2}}" placeholder="Address Line 2" class="form-control">
                    </div>
		    <div class="col-sm-offset-3 help-block with-errors"style=" padding-left:15px;"></div>
                </div>
                <div class="form-group">
                    <label for="city" class="col-sm-3 control-label">City/State</label>
		    <div class="col-sm-4">
			<input type="text" name="city" id="city" value="{{staff.attendee.city}}" placeholder="City" class="form-control" required data-error="City is required. ">
		    </div>
                    <div class="col-sm-5">
			<select class="form-control bfh-states" id="state" data-country="US" data-state="VA" name="state"></select>
                    </div>
		    <div class="col-sm-offset-3 help-block with-errors" style="padding-left:15px;"></div>
                </div>
                <div class="form-group">
                    <label for="country" class="col-sm-3 control-label">ZIP/Country</label>
		    <div class="col-sm-3">
			<input type="text" name="zip" id="zip" value="{{staff.attendee.postalCode}}" placeholder="ZIP Code" class="form-control" data-minlength="5" data-error="Zip code is required.">
		    </div>
                    <div class="col-sm-6">
			<select id="country" class="form-control bfh-countries" data-country="US" name="country"></select>
                    </div>
		    <div class="col-sm-offset-3 help-block with-errors" style="padding-left:15px;"></div>
                </div>
				
		<hr/>

                <div class="form-group">
                    <label for="birthDate" class="col-sm-3 control-label">Date of Birth</label>
                    <div class="col-sm-9">
                        <input type="text" id="birthDate" value="{{staff.attendee.birthdate|date:"m/d/Y"}}" class="form-control" placeholder="mm/dd/yyyy" required disabled>
			<p><button class="btn btn-link btn-sm" data-toggle="modal" data-target="#ageModal">Why do we need this?</button></p>
                    </div>
		    <div class="col-sm-offset-3 help-block with-errors" style="padding-left:15px;"></div>
                </div>

                <div class="form-group">
                    <div class="col-sm-9 col-sm-offset-3">
			<a href="#profile" class="btn btn-primary col-sm-12" aria-controls="registration" role="tab" data-toggle="tab" id="next-personal">Next >></a>
                    </div>
                </div>
            
	</div>
	<div role="tabpanel" class="tab-pane fade" id="profile">
		<h1>Staff Registration - Furthemore 2017</h1>
		<p>Please review and update the information below. If you have any questions about this form, please contact <a href='mailto:registration@furthemore.org'>registration@furthemore.org</a></p>
		<hr>
                <div class="form-group">
                    <label for="add1" class="col-sm-3 control-label">Badge Name</label>
                    <div class="col-sm-9">
                        <input type="text" name="badgeName" id="badgeName" value="{{staff.attendee.badgeName}}" placeholder="Badge Name" class="form-control" required data-error="Badge name is required.">
                    </div>
		    <div class="col-sm-offset-3 help-block with-errors" style="padding-left:15px;"></div>
                </div>

                <div class="form-group">
                    <label for="department" class="col-sm-3 control-label">Department</label>
                    <div class="col-sm-9">
                        <select id="department" name="department"class="form-control" required></select>
                    </div>
		    <div class="col-sm-offset-3 help-block with-errors"style=" padding-left:15px;"></div>
                </div>
                <div class="form-group">
                    <label for="title" class="col-sm-3 control-label">Title</label>
                    <div class="col-sm-9">
                        <input type="text" id="title" name="title" value="{{staff.title}}" placeholder="Title" class="form-control form-control-text" required>
                    </div>
		    <div class="col-sm-offset-3 help-block with-errors"style=" padding-left:15px;"></div>
                </div>
                <div class="form-group">
                    <label for="shirt" class="col-sm-3 control-label">Shirt Size</label>
                    <div class="col-sm-9">
                        <select id="shirt" name="department" class="form-control" required></select>
                    </div>
		    <div class="col-sm-offset-3 help-block with-errors"style=" padding-left:15px;"></div>
                </div>
		<hr/>
		<h3>Emergency Contact Info</h3>
                <div class="form-group">
                    <label for="contactName" class="col-sm-3 control-label">Name</label>
                    <div class="col-sm-9">
                        <input type="text" id="contactName" name="contactName" value="{{staff.contactName}}" placeholder="Contact Name" class="form-control form-control-text" required>
                    </div>
		    <div class="col-sm-offset-3 help-block with-errors"style=" padding-left:15px;"></div>
                </div>
                <div class="form-group">
                    <label for="contactRel" class="col-sm-3 control-label">Relationship</label>
                    <div class="col-sm-9">
                        <input type="text" id="contactRel" name="contactRel" value="{{staff.contactRelation}}" placeholder="Relationship To You" class="form-control form-control-text" required>
                    </div>
		    <div class="col-sm-offset-3 help-block with-errors"style=" padding-left:15px;"></div>
                </div>
                <div class="form-group">
                    <label for="contactPhone" class="col-sm-3 control-label">Phone Number</label>
                    <div class="col-sm-9">
                        <input type="phone" id="contactPhone" name="contactPhone" value="{{staff.contactPhone}}" placeholder="Phone Number" class="form-control form-control-text" required>
                    </div>
		    <div class="col-sm-offset-3 help-block with-errors"style=" padding-left:15px;"></div>
                </div>

		<hr/>
		<h3>Optional Info</h3>
                <div class="form-group">
                    <label for="twitter" class="col-sm-3 control-label">Twitter Handle</label>
                    <div class="col-sm-9">
                        <input type="text" id="twitter" value="{{staff.twitter}}" name="twitter" placeholder="@somefurry" class="form-control form-control-text" />
                    </div>
                </div>
                <div class="form-group">
                    <label for="telegram" class="col-sm-3 control-label">Telegram Handle</label>
                    <div class="col-sm-9">
                        <input type="text" id="telegram" value="{{staff.telegram}}" name="telegram" placeholder="@somefurry" class="form-control form-control-text" />
                    </div>
                </div>
		<div class="form-group">
                    <label for="medical" class="col-sm-3 control-label">Medical Needs</label>
                    <div class="col-sm-9">
                        <input type="text" id="medical" name="medical" value="{{staff.specialMedical}}" class="form-control form-control-text" required />
                    </div>
		    <div class="col-sm-offset-3 help-block with-errors"style=" padding-left:15px;"></div>
		</div>
		<div class="form-group">
                    <label for="food" class="col-sm-3 control-label">Dietary Needs</label>
                    <div class="col-sm-9">
                        <input type="text" id="food" name="food" value="{{staff.specialFood}}" class="form-control form-control-text" required />
                    </div>
		    <div class="col-sm-offset-3 help-block with-errors"style=" padding-left:15px;"></div>
		</div>
		<div class="form-group">
                    <label for="skills" class="col-sm-3 control-label">Additional Skills</label>
                    <div class="col-sm-9">
                        <input type="text" id="skills" name="skills" value="{{staff.specialSkills}}" class="form-control form-control-text" required />
                    </div>
		    <div class="col-sm-offset-3 help-block with-errors"style=" padding-left:15px;"></div>
		</div>

                <div class="form-group">
                    <div class="col-sm-9 col-sm-offset-3">
			<a href="#personal" class="btn btn-primary col-sm-6" aria-controls="registration" role="tab" data-toggle="tab" id="next-personal"><< Back</a>
			<a href="#options" class="btn btn-primary col-sm-6" aria-controls="registration" role="tab" data-toggle="tab" id="next-personal">Next >></a>
                    </div>
                </div>
	</div>
	<div role="tabpanel" class="tab-pane fade" id="options">
		<h1>Staff Registration - Furthemore 2017</h1>
		<p>Please review and update the information below. If you have any questions about this form, please contact <a href='mailto:registration@furthemore.org'>registration@furthemore.org</a></p>

		<div class="row" id="levelContainer"></div>
		<hr/>
                <div class="form-group">
                    <div class="col-sm-9 col-sm-offset-3">
                        <input type="checkbox" id="agreeToRules" name="agreeToRules" class="form-control form-control-checkbox" required />
			I have read and understand the rules pertaining to both Furthemore and the Markeplace. I agree to abide by these rules and by Furthemore's Code of Conduct.
                    </div>
		    <div class="col-sm-offset-3 help-block with-errors"style=" padding-left:15px;"></div>
		</div>
		<div class="form-group">
                    <div class="col-sm-9 col-sm-offset-3">
			<a href="#profile" class="btn btn-primary col-sm-6" aria-controls="registration" role="tab" data-toggle="tab" id="back-badge"><< Back</a>
                        <button id="checkout" type="submit" class="btn btn-primary col-sm-6" aria-controls="profile" data-toggle="tab">Register</button>
		    </div>
                </div>
	</div>
	</div>
	{% csrf_token %}
	</div>
	</form>

	{% endif %}

{% endblock %}

{% block javascript %}
<script type="text/html" id="levelTemplate">
	<div class="col-xs-6 col-sm-6 col-md-6 col-lg-4">
	<div class="panel price">
		<div class="panel-heading  text-center">
		<h3 data-content="name"></h3>
		</div>
		<div class="panel-body text-center">
			<p class="lead" style="font-size:40px"><strong data-content="price"></strong></p>
		</div>
		<div class="panel-footer">
			<a class="btn btn-lg btn-block btn-danger selectLevel" href="#" data-id="levelId">Select</a>
			<a class="btn btn-default btn-block changeLevel" href="#">Change Level?</a>
		</div>
	</div>
	</div>
</script>

<script type="text/html" id="optionBoolTemplate">
	<div class="form-group">
		<label class="col-sm-3 control-label" data-content="name"></label>
		<div class="col-sm-9">
			<input type="checkbox" data-id="id" class="form-control form-control-text levelOptions" />
		</div>
	</div>
<div>
<script type="text/html" id="optionBoolReqTemplate">
	<div class="form-group">
		<label class="col-sm-3 control-label" data-content="name"></label>
		<div class="col-sm-9">
			<input type="checkbox" data-id="id" class="form-control form-control-text levelOptions" required />
		</div>
	</div>
<div>

</script>
<script type="text/html" id="optionIntTemplate">
	<div class="form-group">
		<label class="col-sm-3 control-label" data-content="name"></label>
		<div class="col-sm-9">
			<input type="number" data-id="id" class="form-control form-control-text levelOptions" min=0 />
		</div>
	</div>

</script>
<script type="text/html" id="optionIntReqTemplate">
	<div class="form-group">
		<label class="col-sm-3 control-label" data-content="name"></label>
		<div class="col-sm-9">
			<input type="number" data-id="id" class="form-control form-control-text levelOptions" required min=0 />
		</div>
	</div>

</script>
<script type="text/html" id="optionStringTemplate">
	<div class="form-group">
		<label class="col-sm-3 control-label" data-content="name"></label>
		<div class="col-sm-9">
			<input type="text" data-id="id" max-length=15 class="form-control form-control-text levelOptions"
			data-template-bind='{"attribute": "placeholder", "value": "placeholder"}' />
		</div>
	</div>
</script>
<script type="text/html" id="optionStringReqTemplate">
	<div class="form-group">
		<label class="col-sm-3 control-label" data-content="name"></label>
		<div class="col-sm-9">
			<input type="text" data-id="id" max-length=15 class="form-control form-control-text levelOptions" required
			data-template-bind='{"attribute": "placeholder", "value": "placeholder"}' />
		</div>
	</div>
</script>
<script type="text/html" id="optionListTemplate">
	<div class="form-group">
		<label class="col-sm-3 control-label" data-content="name"></label>
		<div class="col-sm-9">
			<select data-id="id" class="form-control form-control-select levelOptions" 
			  data-template-bind='{"attribute": "options", "value": {"data": "options", "value":"value", "content":"content"}}'></select>
		</div>
	</div>
</script>
<script type="text/html" id="optionJerseyTemplate">
	<br/>
        <h4>Year 5 Jersey</h4>
        <hr/>
        <div class="small form-group">Order a special commemorative baseball jersey celebrating 5 years of Furthemore!
                <br/>Click <button class="btn btn-link btn-sm" data-toggle="modal" data-target="#jerseyModal">here</button> for pictures a$
   	<hr/>
	<div class="form-group">
		<label class="col-sm-3 control-label">Jersey Name</label>
		<div class="col-sm-9">
			<input type="text" id="jerseyName" max-length=15 class="form-control form-control-text" />
			<input type="hidden" id="optionId" data-value="optionId" />
		</div>
	</div>
	<div class="form-group">
		<label class="col-sm-3 control-label">Jersey Number</label>
		<div class="col-sm-9">
			<input type="text" id="jerseyNumber" maxlength=2 class="form-control form-control-text" />
		</div>
	</div>
	<div class="form-group">
		<label class="col-sm-3 control-label">Jersey Size</label>
		<div class="col-sm-9">
			<select id="jerseySize" class="form-control form-control-select" 
			  data-template-bind='{"attribute": "options", "value": {"data": "options", "value":"value", "content":"content"}}'></select>
		</div>
	</div>
</script>
<script type="text/html" id="optionStaffJerseyTemplate">
	<br/>
	<h4>Year 5 Staff Jersey</h4>
	<hr/>
        <div class="small form-group">Order a special commemorative baseball jersey celebrating 5 years of Furthemore! 
		<br/>Click <button class="btn btn-link btn-sm" data-toggle="modal" data-target="#jerseyStaffModal">here</button> for pictures and more information.</div>
 	<hr/>
	<div class="form-group">
		<label class="col-sm-3 control-label">Staff Jersey Name</label>
		<div class="col-sm-9">
			<input type="text" id="sjerseyName" max-length=15 class="form-control form-control-text" />
			<input type="hidden" id="soptionId" data-value="optionId" />
		</div>
	</div>
	<div class="form-group">
		<label class="col-sm-3 control-label">Staff Jersey Number</label>
		<div class="col-sm-9">
			<input type="text" id="sjerseyNumber" maxlength=2 class="form-control form-control-text" />
		</div>
	</div>
	<div class="form-group">
		<label class="col-sm-3 control-label">Staff Jersey Size</label>
		<div class="col-sm-9">
			<select id="sjerseySize" class="form-control form-control-select" 
			  data-template-bind='{"attribute": "options", "value": {"data": "options", "value":"value", "content":"content"}}'></select>
		</div>
	</div>
</script>


 <script type="text/javascript">
	var levelTemplateData = [];
	var staff = {{ jsonStaff|safe }} 
	var attendee = {{ jsonAttendee|safe }} 
	var currentLevel = {{ jsonLevel|safe }}
	var takenJerseys = [];
	var takenStaffJerseys = [];
	var shirtSizes = [];

	$( "body" ).ready(function() {
		$.getJSON("/apis/registration/pricelevels", function(data) {
			levelData = data;
			var prevLevel = 45;
			if (currentLevel && currentLevel.hasOwnProperty("basePrice")){
				prevLevel = parseFloat(currentLevel.basePrice);
			}
			$.each( data, function( key, val ) {
				levelTemplateData.push({
					name: val.name,
					price: "$" + (val.base_price - prevLevel),
					levelId: "level_" + val.id,
				});
			});
			$("#levelContainer").loadTemplate($("#levelTemplate"), levelTemplateData);
			$(".changeLevel").hide();
			
		});
		$.getJSON("/apis/registration/alldepartments", function(data) {
			deptData = data;
			$.each(data, function(key, val) {
				$("#department").append("<option value='" + val.id + "'>" + val.name + "</option>");
			});
		});
		$.getJSON("/apis/registration/shirts", function(data) {
			$.each(data, function(key, val) {
				$("#shirt").append("<option value='" + val.id + "'>" + val.name + "</option>");
			});
			shirtSizes = data;
		});
		$.getJSON("/apis/registration/takenJerseys", function(data) {
			takenJerseys = data;
		});
		$.getJSON("/apis/registration/takenStaffJerseys", function(data) {
			takenStaffJerseys = data;
		});
        });

	$("#levelContainer").on('click', 'a.selectLevel', function(){
		clearLevels();
		var levelId = $(this).attr('id').split('_')[1];
		$.each( levelTemplateData, function( key, val ) {
			var id = val.levelId.split('_')[1];
			if (id == levelId){
				$("#regLevel").val(val.name);
				$("#levelContainer").loadTemplate($("#levelTemplate"), val);
				$(".changeLevel").show();
				$(".selectLevel").text("Selected!");
				generateOptions(id);
				return false;
			}
		});
	});
	$("#levelContainer").on('click', 'a.changeLevel', function() {
		$("#levelContainer").loadTemplate($("#levelTemplate"), levelTemplateData);		
		$("#regLevel").val("");
		$(".changeLevel").hide();
	});
	var clearLevels = function(){
		$.each( levelTemplateData, function( key, val ) {
			$("#"+val.levelId).text("Select " + val.name);
		});
		$("form").validator('update');
	};

	var generateOptions = function(levelId){
		var data = [];
		$.each(levelData, function(key, thing){
			if (thing.id == levelId){
				data = thing.options;
				return false;
			}
		});
		var container = $("<div id='optionsContainer' class='col-xs-6 col-sm-6 col-md-6 col-lg-8'><h4>Registration Options</h4><hr/></div>");
		$("#levelContainer").append(container);
		$.each( data, function(key, val) {
			if (val.value == "0.00"){
				var price = " (Free) ";
			} else {
				var price = " (+$" + val.value + ") "
			}
			var required = "";
			if (val.required) {required = "required";}
			switch (val.type){
				case "bool":
					var template = $("#optionBoolTemplate");
					if (val.required) {template = $("#optionBoolReqTemplate");}
					$("#optionsContainer").loadTemplate(template, {
						'name': val.name + " " + price,
						'id': "option_" + val.id
					}, {append: true});
					break;
				case "int":
					var template = $("#optionIntTemplate");
					if (val.required) {template = $("#optionIntReqTemplate");}
					$("#optionsContainer").loadTemplate(template, {
						'name': val.name + " " + price,
						'id': "option_" + val.id
					}, {append: true});
					break;
				case "string":
					var template = $("#optionStringTemplate");
					if (val.required) {template = $("#optionStringReqTemplate");}
					var placeholder = val.name;
					$("#optionsContainer").loadTemplate(template, {
						'name': val.name + " " + price,
						'id': "option_" + val.id,
						'placeholder': placeholder,
					}, {append: true});
					break;
				case "Jersey":
					var options = [];
					$.each(shirtSizes, function (key, item) {
						options.push({"content": item.name, "value": item.id})
					});
					$("#optionsContainer").loadTemplate($("#optionJerseyTemplate"), {
						'name': val.name + " " + price,
						'optionId': val.id,
						'options': options
					}, {append: true});
					break;
				case "StaffJersey":
					var options = [];
					$.each(shirtSizes, function (key, item) {
						options.push({"content": item.name, "value": item.id})
					});
					$("#optionsContainer").loadTemplate($("#optionStaffJerseyTemplate"), {
						'name': val.name + " " + price,
						'optionId': val.id,
						'options': options
					}, {append: true});
					break;
				default:
					if (val.list == []){break;}
					var options = [];
					if (!val.required) {options.push({"content": "Select One...", "value": ""});}
					$.each(val.list, function (key, item) {
						options.push({"content": item.name, "value": item.id})
					});
					$("#optionsContainer").loadTemplate($("#optionListTemplate"), {
						'name': val.name + " " + price,
						'id': "option_" + val.id,
						'options': options
					}, {append: true});
					break;
			}
		});
		
		$("form").validator('update');
	};
	var getJersey = function() {
		var jersey = {};
		if ($("#jerseyName").val() == "") {return jersey;}
		jersey = {
			'name': $("#jerseyName").val(),
			'number': $("#jerseyNumber").val(),
			'size': $("#jerseySize").val(),
			'optionId': $("#optionId").val()
		};
		return jersey;
	};
	var getStaffJersey = function() {
		var jersey = {};
		if ($("#sjerseyName").val() == "") {return jersey;}
		jersey = {
			'name': $("#sjerseyName").val(),
			'number': $("#sjerseyNumber").val(),
			'size': $("#sjerseySize").val(),
			'optionId': $("#soptionId").val()
		};
		return jersey;
	};
	var getOptions = function() {
		var options = $(".levelOptions");
                var data = [];
		$.each(options, function(key, option) {
			data.push({'id': option.id.split('_')[1], 'value': $(option).val()});
		});
		return data;
	};


	$("#country").on("change", function() {
		if ($(this).val() == "US"){
			$("#state").val("VA").removeAttr("disabled").attr("required", "required");
			$("#zip").val("").removeAttr("disabled").attr("required", "required");
		} else {
			$("#state").val("").attr("disabled", "disabled").removeAttr("required");
			$("#zip").val("").attr("disabled", "disabled").removeAttr("required");
		}
	});


	$("#checkout").click(doRegister);
	

	function doRegister(e) {
		e.preventDefault();
		$("form").validator('validate');
		var errorCount = $(".has-error").length;
		if (errorCount > 0) {return;}

		$("#checkout").attr("disabled", "disabled");

		var data = {
			'attendee': {
				'id': attendee.id,
				'firstName': $("#firstName").val(), 'lastName': $("#lastName").val(), 
				'address1': $("#add1").val(), 'address2': $("#add2").val(), 'city': $("#city").val(), 
				'state': $("#state").val(), 'country': $("#country").val(), 'postal': $("#zip").val(),
				'phone': $("#phone").val(), 'badgeName': $("#badgeName").val()
			}, 
			'staff': {
				'id': staff.id, 
				'department': $("#department").val(), 'title': $("#title").val(),
				'twitter': $("#twitter").val(), 'telegram': $("#telegram").val(),
				'shirtsize': $("#shirt").val(), 'specialSkills': $("#skills").val(),
				'specialFood': $("#food").val(), 'specialMedical': $("#medical").val(),
				'contactPhone': $("#contactPhone").val(), 'contactName': $("#contactName").val(),
				'contactRelation': $("#contactRel").val(),
			},
			'priceLevel': { 'id': $(".selectLevel")[0].id.split('_')[1], 'options': getOptions() },
			'jersey': getJersey(),
			'staffjersey': getStaffJersey()
		};
		

		$.ajax({
		    "type": "POST",
		    "dataType": "json",
		    "url": "/apis/registration/staff/add/",
		    "data": JSON.stringify(data),
		    "beforeSend": function(xhr, settings) {
		        console.log("Before Send");
		        $.ajaxSettings.beforeSend(xhr, settings);
		    },
		    "error": function(result, status, error) {
			if (result.responseText == "") {
				alert("Your session has expired.");
			} else {
                        	alert("An error has occurred. Please check the form for any error messages. If this error continues, please contact registration@furthemore.org for assistence.")
			}
			$("#checkout").removeAttr("disabled");
		    },
                    "success": function (result, status) {
                        if (result.success)
                        {
 	                    window.location = "/apis/registration/staff/invoice";
                        } else {
			    $("#checkout").removeAttr("disabled");
                    	    alert("An error has occurred. Please check the form for any error messages. If this error continues, please contact registration@furthemore.org for assistence.")
			}
                    }
		});
	}



function getCookie(name) {
    var cookieValue = null;
    if (document.cookie && document.cookie != '') {
        var cookies = document.cookie.split(';');
        for (var i = 0; i < cookies.length; i++) {
            var cookie = jQuery.trim(cookies[i]);
            // Does this cookie string begin with the name we want?
            if (cookie.substring(0, name.length + 1) == (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

$.ajaxSetup({
    beforeSend: function(xhr, settings) {
        if (!(/^http:.*/.test(settings.url) || /^https:.*/.test(settings.url))) {
            // Only send the token to relative URLs i.e. locally.
            xhr.setRequestHeader("X-CSRFToken", getCookie('csrftoken'));
        }
    }
});




 </script>

{% endblock %}
